{
	# Optional: enable access logs
	# debug
}

api.4.187.225.54.nip.io {
	encode zstd gzip
	# NOTE: CORS is now handled exclusively by the upstream Express server.
	# Removing proxy-level injection prevents duplicate Access-Control-Allow-Origin
	# headers (browser rejects multiple values). If you need edge-level CORS later,
	# add headers here AND strip upstream ones via `header_down -Access-Control-*`.
	@api {
		path /health*
		path /ready*
		path /api/*
		path /auth/*
	}
	reverse_proxy @api api:5000 {
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-For {remote}
	}

	# Pass everything else to AI service if needed (optional endpoint base)
	@ai {
		path /check
		path /highlight_pdf
	}
	reverse_proxy @ai ai:8000

	# Basic security headers (Caddy v2 directive is 'header')
	header {
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "no-referrer"
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
	}
}
